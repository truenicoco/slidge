image: alpine/edge
packages:
  - docker
  - docker-cli-buildx
sources:
  - https://git.sr.ht/~nicoco/slidge
artifacts:
  - ./slidge-docs.tar.gz
tasks:
  - setup-docker: |
      sudo service docker start
      sudo addgroup build docker
      while ! test -e /var/run/docker.sock; do sleep 1; done
      docker buildx create --use
  - tests: |
      docker buildx build -f slidge/dev/Containerfile-tests . -o ./
